# IDCeMPy: Estimation of "Inflated" Discrete Choice Models

*Nguyen K. Huynh, Sergio Bejar, Nicolas Schmidt, Vineeta Yadav, Bumba Mukherjee*

<!-- badges: start -->

[![PyPI version fury.io](https://badge.fury.io/py/ziopcpy.svg)](https://pypi.org/project/ziopcpy/0.1.2/)
[![PyPI pyversions](https://img.shields.io/pypi/pyversions/ziopcpy.svg)](https://pypi.org/project/ziopcpy/0.1.2/)
[![Downloads](https://pepy.tech/badge/ziopcpy)](https://pepy.tech/project/ziopcpy)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](https://lbesson.mit-license.org/)
<!-- badges: end -->

**IDCeMPy** is a Python package which:

* Makes it easy to compose and fit ordered probit models when your discrete outcome variable is "inflated"  in either the zero or middle categories without (ZiOP/MiOPC) and with correlated errors (ZiOPC/MiOPC).    
* Fits inflated multi-nomial logit (iMNL) models that account for the preponderant (and heterogeneous) share
of observations in the baseline or any other lower category in unordered polytomous choice
outcomes.
* Allows you to easily compute the goodness-of-fit tests (AIC and Log-likelihood) and assess the performance (Vuong Test) of the "inflated" choice models with respect to standard ordered probit (OP) and multi-nomial logit (MNL) models. 

**IDCeMPy** uses Newton numerical optimization methods to estimate the "inflated" discrete choice models described above via Maximum Likelihood Estimation (MLE).  
**IDCeMPY** is compatible with [Python](https://python.org) 3.7+

## Getting Started

You can try **IDCeMPy** now by downloading it from GitHub or PyPi.
On [readthedocs](https://ziopcpy.readthedocs.io/) you will find the installation guide, a complete overview of all the fueatures included in **IDCeMPy**, and example scripts of all the models. 

## Why **IDCeMPy**?

Researchers in natural and social sciences typically use Ordered Probit (OP) and Multi-Nomial Logit (MNL) models when working with discrete outcome variables that have more than two categories.  Using those models, however, may lead to biased inferences when:

* The lowest category of the outcome variable presents an excess of "zeros" (i.e. Zero Inflation) that are generated from different d.g.p's.
* An excessive number of observations are in the middle categories of the outcome variable (i.e. Middle Inflation), and generated by distinct d.g.p's.
* The lower outcome categories incorporate an
excessive share and heterogeneous pool of observations. 
  
**IDCePy** combines two probability distributions by estimating two latent (split and outcome-stage)
equations in zero and middle inflated OP models, and MNL models with unordered outcome variables, allowing to statistically assess the inflated share
of observations in your ordered outcome variable.

## Functions in the **IDCePy** Package

| Function         | Description                                                                                                          |
| ---------------- | -------------------------------------------------------------------------------------------------------------------- |
| `opmod`; `iopmod`; `iopcmod` | fit the standard OP model, the zero-inflated and middle inflated OP models without correlated errors (ZiOP and MiOP), and the zero-inflated and middle inflated OP model with correlated errors (ZiOPC and MiOPC) respectively. |
|`opresults`; `iopresults`; `iopcresults`| Stores and presents the covariate estimates, the Variance-Covariance (VCV) matrix, and goodness-of-fit statistics (Log-Likelihood and AIC) of `opmod`, `iopmod`, and `iopcmod` respectively. |
| `iopfit`; `iopcfit`| Computes the fitted probabilities from the ZiOP, MiOP, ZiOPC and MiOPC models respectively.|
| `vuong_opiop`;  `vuong_opiopc` | Calculates the Vuong test statistic to compare the performance of the OP versus the ZiOP, ZiOPC, MiOP or MiOPC models respectively.|
|`bimnlmod` | fits and inflated multi-nomial Logit (BiNML) model.|
|`bimnlresults` | Stores and presents the covariate estimates, the Variance-Covariance (VCV) matrix, and the goodness-of-fit statistics (Log-Likelihood and AIC) of `bimnlmod`.|

## Dependencies
- scipy
- numpy
- pandas

## Installation

From [PyPi](https://pypi.org/project/ziopcpy/0.1.2/):

```sh
$ pip install ziopcpy
```

## Using the Package

We illustrate the functionality of **IDCePy** using data from the National Youth Tobacco Survey (2018) and XXXX (xxx). 

First, import `ZiopcPy`, required packages, and dataset.
```
from ziopcpy import ziopcpy
import pandas as pd
import urllib
url= 'https://github.com/hknd23/ziopcpy/raw/master/data/tobacco_cons.csv'
DAT= pd.read_csv(url)
```
We now specify arrays of variable names (strings) X, Y, Z.
```
X = ['age', 'grade', 'gender']
Y = ['cig_count']
Z = ['age']
```
In addition, we define an array of starting parameters before estimating the `ziopc` model. 
```
pstart = np.array([.1, .15, .001, .2, .3, .3, .001, .2, .01, .01])
```
The following line of code creates a `ziopc` regression object model.
```
ziopc_tob = iopcmod('ziopc', pstartziopc, data, X, Y, Z, method='bfgs',
                    weights=1, offsetx=0, offsetz=0)
```
The results of this example are stored in a class (`ZiopcModel`) with the following attributes:
  * *coefs*: Model coefficients and standard errors
  * *llik*: Log-likelihood
  * *AIC*: Akaike information criterion
  * *vcov*: Variance-covariance matrix

We, for example, can print out the covariate estimates, standard errors, *p* value and *t* statistics by typing:
```
print(ziopc_tobb.coefs)
```
```
              2.5%     97.5%      Coef        SE         p    tscore
cut1     -1.140210  2.643246  0.751518  0.965167  0.436192  0.778640
cut2     -1.209736 -0.130255 -0.669995  0.275378  0.014974 -2.433003
cut3     -2.769668  0.324247 -1.222711  0.789264  0.121339 -1.549179
cut4     -2.442634  1.208168 -0.617233  0.931327  0.507493 -0.662746
Z int    -2.158451  2.020689 -0.068881  1.066107  0.948484 -0.064610
Z age    -1.059072  1.024847 -0.017112  0.531612  0.974321 -0.032190
X age    -0.120082  0.254096  0.067007  0.095454  0.482689  0.701984
X grade  -0.447309  0.111297 -0.168006  0.142502  0.238408 -1.178975
X gender -2.421751  0.795825 -0.812963  0.820810  0.321959 -0.990439
rho      -1.575206  3.306348  0.865571  1.245294  0.487009  0.695073  
```
Or the Akaike Information Criterion (AIC):
```
print(ziopc_tobb.AIC)
```
```
16061.716497590078
```

## Reduced Specification of MiOPC?

## Reduced Specification of BiMNL?
```
	Coef	SE	tscore	p	2.50%	97.50%
Inflation: int	-5.171534274	0.333433802	-15.50992802	0	-5.825064527	-4.518004022
Inflation: educ	2.044203218	0.291373671	7.015744468	2.29E-12	1.473110824	2.615295613
Inflation: agegroup2	1.334397084	0.14817227	9.005714012	0	1.043979436	1.624814733
1: int	-3.980612079	0.274233272	-14.51542349	0	-4.518109292	-3.443114866
1: educ	0.345675059	0.092162763	3.750702002	0.00017634	0.165036044	0.526314073
1: female	-0.665517202	0.233805137	-2.846460989	0.004420815	-1.12377527	-0.207259133
1: black	0.508167759	0.392719627	1.293970875	0.195675481	-0.26156271	1.277898228
1: hispanic	-0.54150272	0.397877828	-1.360977369	0.173520841	-1.321343264	0.238337824
1: party7	0.467379228	0.060266782	7.755171517	8.88E-15	0.349256336	0.58550212
1: agegroup2	0.964057511	0.148327675	6.499512044	8.06E-11	0.673335268	1.254779754
2: int	1.019743708	0.392141546	2.600448025	0.009310212	0.251146279	1.788341138
2: educ	0.178932762	0.1079619	1.657369522	0.097444789	-0.032672561	0.390538086
2: female	-0.293113797	0.289506891	-1.012458793	0.31131874	-0.860547303	0.274319709
2: black	-0.482911511	0.396835502	-1.216906018	0.223639976	-1.260709095	0.294886073
2: hispanic	-0.89482826	0.579678198	-1.543663818	0.122669796	-2.030997527	0.241341008
2: party7	-0.568743163	0.054611401	-10.41436675	0	-0.67578151	-0.461704816
2: agegroup2	0.884658022	0.12909482	6.852777076	7.24E-12	0.631632175	1.137683869
```



 
