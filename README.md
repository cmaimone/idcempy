# IDCeMPy: Estimation of "Inflated" Discrete Choice Models

*Nguyen K. Huynh, Sergio Bejar, Nicolas Schmidt, Vineeta Yadav, Bumba Mukherjee*

<!-- badges: start -->

[![PyPI version fury.io](https://badge.fury.io/py/ziopcpy.svg)](https://pypi.org/project/ziopcpy/0.1.2/)
[![PyPI pyversions](https://img.shields.io/pypi/pyversions/ziopcpy.svg)](https://pypi.org/project/ziopcpy/0.1.2/)
[![Downloads](https://pepy.tech/badge/ziopcpy)](https://pepy.tech/project/ziopcpy)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](https://lbesson.mit-license.org/)
<!-- badges: end -->

**IDCeMPy** is a Python package which:

* Makes it easy to compose and fit ordered probit models when your discrete outcome variable is "inflated"  in either the zero or middle categories without (ZiOP/MiOPC) and with correlated errors (ZiOPC/MiOPC).    
* Fits inflated multi-nomial logit (iMNL) models that account for the preponderant (and heterogeneous) share
of observations in the baseline or any other lower category in unordered polytomous choice
outcomes.
* Allows you to easily compute the goodness-of-fit tests (AIC and Log-likelihood) and assess the performance (Vuong Test) of the "inflated" choice models with respect to standard ordered probit (OP) and multi-nomial logit (MNL) models. 

**IDCeMPy** uses Newton numerical optimization methods to estimate the "inflated" discrete choice models described above via Maximum Likelihood Estimation (MLE).  
**IDCeMPY** is compatible with [Python](https://python.org) 3.7+

## Getting Started

You can try **IDCeMPy** now by downloading it from GitHub or PyPi.
On [readthedocs](https://ziopcpy.readthedocs.io/) you will find the installation guide, a complete overview of all the fueatures included in **IDCeMPy**, and example scripts of all the models. 

## Why **IDCeMPy**?

Researchers in natural and social sciences typically use Ordered Probit (OP) and Multi-Nomial Logit (MNL) models when working with discrete outcome variables that have more than two categories.  Using those models, however, may lead to biased inferences when:

* The lowest category of the outcome variable presents an excess of "zeros" (i.e. Zero Inflation) that are generated from different d.g.p's.
* An excessive number of observations are in the middle categories of the outcome variable (i.e. Middle Inflation), and generated by distinct d.g.p's.
* The lower outcome categories incorporate an
excessive share and heterogeneous pool of observations. 
  
**IDCePy** combines two probability distributions by estimating two latent (split and outcome-stage)
equations in zero and middle inflated OP models, and MNL models with unordered outcome variables, allowing to statistically assess the inflated share
of observations in your ordered outcome variable.

## Functions in the **IDCePy** Package

| Function         | Description                                                                                                          |
| ---------------- | -------------------------------------------------------------------------------------------------------------------- |
| `opmod`; `iopmod`; `iopcmod` | fit the standard OP model, the zero-inflated and middle inflated OP models without correlated errors (ZiOP and MiOP), and the zero-inflated and middle inflated OP model with correlated errors (ZiOPC and MiOPC) respectively. |
|`opresults`; `iopresults`; `iopcresults`| Stores and presents the covariate estimates, the Variance-Covariance (VCV) matrix, and goodness-of-fit statistics (Log-Likelihood and AIC) of `opmod`, `iopmod`, and `iopcmod` respectively. |
| `iopfit`; `iopcfit`| Computes the fitted probabilities from the ZiOP, MiOP, ZiOPC and MiOPC models respectively.|
| `vuong_opiop`;  `vuong_opiopc` | Calculates the Vuong test statistic to compare the performance of the OP versus the ZiOP, ZiOPC, MiOP or MiOPC models respectively.|
|`bimnlmod` | fits and inflated multi-nomial Logit (BiNML) model.|
|`bimnlresults` | Stores and presents the covariate estimates, the Variance-Covariance (VCV) matrix, and the goodness-of-fit statistics (Log-Likelihood and AIC) of `bimnlmod`.|

## Dependencies
- scipy
- numpy
- pandas

## Installation

From [PyPi](https://pypi.org/project/ziopcpy/0.1.2/):

```sh
$ pip install ziopcpy
```

## Using the Package

We illustrate the functionality of **IDCePy** using data from the National Youth Tobacco Survey (2018) and XXXX (xxx). 

First, import `ZiopcPy`, required packages, and dataset.
```
from ziopcpy import ziopcpy
import pandas as pd
import urllib
url= 'https://github.com/hknd23/ziopcpy/raw/master/data/tobacco_cons.csv'
DAT= pd.read_csv(url)
```
We now specify arrays of variable names (strings) X, Y, Z.
```
X = ['age', 'grade', 'gender']
Y = ['cig_count']
Z = ['age']
```
In addition, we define an array of starting parameters before estimating the `ziopc` model. 
```
pstart = np.array([.1, .15, .001, .2, .3, .3, .001, .2, .01, .01])
```
The following line of code creates a `ziopc` regression object model.
```
ziopc_tob = iopcmod('ziopc', pstartziopc, data, X, Y, Z, method='bfgs',
                    weights=1, offsetx=0, offsetz=0)
```
The results of this example are stored in a class (`ZiopcModel`) with the following attributes:
  * *coefs*: Model coefficients and standard errors
  * *llik*: Log-likelihood
  * *AIC*: Akaike information criterion
  * *vcov*: Variance-covariance matrix

We, for example, can print out the covariate estimates, standard errors, *p* value and *t* statistics by typing:
```
print(ziopc_tobb.coefs)
```
```
              2.5%     97.5%      Coef        SE         p    tscore
cut1     -1.140210  2.643246  0.751518  0.965167  0.436192  0.778640
cut2     -1.209736 -0.130255 -0.669995  0.275378  0.014974 -2.433003
cut3     -2.769668  0.324247 -1.222711  0.789264  0.121339 -1.549179
cut4     -2.442634  1.208168 -0.617233  0.931327  0.507493 -0.662746
Z int    -2.158451  2.020689 -0.068881  1.066107  0.948484 -0.064610
Z age    -1.059072  1.024847 -0.017112  0.531612  0.974321 -0.032190
X age    -0.120082  0.254096  0.067007  0.095454  0.482689  0.701984
X grade  -0.447309  0.111297 -0.168006  0.142502  0.238408 -1.178975
X gender -2.421751  0.795825 -0.812963  0.820810  0.321959 -0.990439
rho      -1.575206  3.306348  0.865571  1.245294  0.487009  0.695073  
```
Or the Akaike Information Criterion (AIC):
```
print(ziopc_tobb.AIC)
```
```
16061.716497590078
```

## Reduced Specification of MiOPC?
```
url= 'https://github.com/hknd23/zmiopc/raw/main/data/EUKnowledge.dta'
data= pd.read_stata(url)

```
```
Y = ["EU_support_ET"]
X = ['Xenophobia', 'discuss_politics']
Z = ['discuss_politics', 'EU_Know_obj']
```
```
miopc_EU = ziopc.iopcmod('miopc', DAT, X, Y, Z)
```
```
                              Coef    SE  tscore     p   2.5%  97.5%
cut1                        -1.370 0.044 -30.948 0.000 -1.456 -1.283
cut2                        -0.322 0.103  -3.123 0.002 -0.524 -0.120
Inflation: int              -0.129 0.021  -6.188 0.000 -0.170 -0.088
Inflation: discuss_politics  0.192 0.026   7.459 0.000  0.142  0.243
Inflation: EU_Know_obj       0.194 0.027   7.154 0.000  0.141  0.248
Ordered: Xenophobia         -0.591 0.045 -13.136 0.000 -0.679 -0.502
Ordered: discuss_politics   -0.029 0.021  -1.398 0.162 -0.070  0.012
rho                         -0.707 0.106  -6.694 0.000 -0.914 -0.500
```

## Reduced Specification of BiMNL?

```
from zmiopc import bimnl
url= 'https://github.com/hknd23/zmiopc/raw/main/data/replicationdata.dta'
data= pd.read_stata(url)
```
```
x = ['educ', 'party7', 'agegroup2']
z = ['educ', 'agegroup2']
y = ['vote_turn']

```
```
order = [0, 1, 2]
inflatecat = "baseline"
```
```
imnl_2004vote = bimnl.imnlmod(data, x, y, z, order, inflatecat)
```
```
                       Coef    SE  tscore     p    2.5%  97.5%
Inflation: int       -4.935 2.777  -1.777 0.076 -10.379  0.508
Inflation: educ       1.886 0.293   6.441 0.000   1.312  2.460
Inflation: agegroup2  1.295 0.768   1.685 0.092  -0.211  2.800
1: int               -4.180 1.636  -2.556 0.011  -7.387 -0.974
1: educ               0.334 0.185   1.803 0.071  -0.029  0.697
1: party7             0.454 0.057   7.994 0.000   0.343  0.566
1: agegroup2          0.954 0.248   3.842 0.000   0.467  1.441
2: int                0.900 1.564   0.576 0.565  -2.166  3.966
2: educ               0.157 0.203   0.772 0.440  -0.241  0.554
2: party7            -0.577 0.058  -9.928 0.000  -0.691 -0.463
2: agegroup2          0.916 0.235   3.905 0.000   0.456  1.376
```


 
