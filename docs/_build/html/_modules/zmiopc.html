
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>zmiopc &#8212; IDCeMPy  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">IDCeMPy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for zmiopc</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Classes and Functions for the ziopcpy module.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># ZiOPC model converges extremely</span>
<span class="c1"># faster with import * rather than import as np.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mvn</span><span class="p">,</span> <span class="n">norm</span>


<div class="viewcode-block" id="OpModel"><a class="viewcode-back" href="../api.html#zmiopc.OpModel">[docs]</a><span class="k">class</span> <span class="nc">OpModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store model results from :py:func:`opmod`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llik</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">vcov</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">yncat</span><span class="p">,</span>
                 <span class="n">xstr</span><span class="p">,</span> <span class="n">ystr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store model results, goodness-of-fit tests, and other information.</span>

<span class="sd">        :param llik: Log-Likelihood.</span>
<span class="sd">        :param coef: Model coefficients.</span>
<span class="sd">        :param aic: Model Akaike information criterion.</span>
<span class="sd">        :param vcov: Variance-Covariance matrix.</span>
<span class="sd">            (optimized as inverted Hessian matrix)</span>
<span class="sd">        :param data: Full dataset.</span>
<span class="sd">        :param ts: Cutpoints for ordered probit.</span>
<span class="sd">        :param xs: Ordered probit estimates (Betas).</span>
<span class="sd">        :param yncat: Number of categories in the outcome variable.</span>
<span class="sd">        :param x_: X (Covariates) Data.</span>
<span class="sd">        :param yx_: Y (Dependent Variable) data.</span>
<span class="sd">        :param xstr: list of strings for variable(s) in the outcome stage (x).</span>
<span class="sd">        :param ystr: list of strings for outcome variable name (y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llik</span> <span class="o">=</span> <span class="n">llik</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">coef</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="n">aic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">=</span> <span class="n">vcov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutpoints</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ycat</span> <span class="o">=</span> <span class="n">yncat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">yx_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ystr</span> <span class="o">=</span> <span class="n">ystr</span></div>


<div class="viewcode-block" id="IopModel"><a class="viewcode-back" href="../api.html#zmiopc.IopModel">[docs]</a><span class="k">class</span> <span class="nc">IopModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store model results from :py:func:`iopmod`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">modeltype</span><span class="p">,</span>
            <span class="n">llik</span><span class="p">,</span>
            <span class="n">coef</span><span class="p">,</span>
            <span class="n">aic</span><span class="p">,</span>
            <span class="n">vcov</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">xs</span><span class="p">,</span>
            <span class="n">zs</span><span class="p">,</span>
            <span class="n">ts</span><span class="p">,</span>
            <span class="n">x_</span><span class="p">,</span>
            <span class="n">yx_</span><span class="p">,</span>
            <span class="n">z_</span><span class="p">,</span>
            <span class="n">yncat</span><span class="p">,</span>
            <span class="n">xstr</span><span class="p">,</span>
            <span class="n">ystr</span><span class="p">,</span>
            <span class="n">zstr</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store model results, goodness-of-fit tests, and other information.</span>

<span class="sd">        :param modeltype: Type of Iop Model (ziop or miop).</span>
<span class="sd">        :param llik: Log-Likelihood.</span>
<span class="sd">        :param coef: Model coefficients</span>
<span class="sd">        :param aic: Model Akaike information criterion.</span>
<span class="sd">        :param vcov: Variance-Covariance matrix.</span>
<span class="sd">            (optimized as inverted Hessian matrix)</span>
<span class="sd">        :param data: Full dataset.</span>
<span class="sd">        :param ts: Cutpoints for ordered probit.</span>
<span class="sd">        :param zs: Inflation stage estimates (Gammas).</span>
<span class="sd">        :param xs: Ordered probit estimates (Betas).</span>
<span class="sd">        :param yncat: Number of categories in the Dependent Variable (DV).</span>
<span class="sd">        :param x_: X Data.</span>
<span class="sd">        :param yx_: Y (DV) data.</span>
<span class="sd">        :param z_: Z Data.</span>
<span class="sd">        :param xstr: list of strings for x names.</span>
<span class="sd">        :param ystr: list of strings for y names.</span>
<span class="sd">        :param zstr: list of strings for z names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">=</span> <span class="n">modeltype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llik</span> <span class="o">=</span> <span class="n">llik</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">coef</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="n">aic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">=</span> <span class="n">vcov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutpoints</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflate</span> <span class="o">=</span> <span class="n">zs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ycat</span> <span class="o">=</span> <span class="n">yncat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">yx_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">z_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ystr</span> <span class="o">=</span> <span class="n">ystr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zstr</span> <span class="o">=</span> <span class="n">zstr</span></div>


<div class="viewcode-block" id="IopCModel"><a class="viewcode-back" href="../api.html#zmiopc.IopCModel">[docs]</a><span class="k">class</span> <span class="nc">IopCModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store model results from :py:func:`iopcmod`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">modeltype</span><span class="p">,</span>
            <span class="n">llik</span><span class="p">,</span>
            <span class="n">coef</span><span class="p">,</span>
            <span class="n">aic</span><span class="p">,</span>
            <span class="n">vcov</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">xs</span><span class="p">,</span>
            <span class="n">zs</span><span class="p">,</span>
            <span class="n">ts</span><span class="p">,</span>
            <span class="n">x_</span><span class="p">,</span>
            <span class="n">yx_</span><span class="p">,</span>
            <span class="n">z_</span><span class="p">,</span>
            <span class="n">rho</span><span class="p">,</span>
            <span class="n">yncat</span><span class="p">,</span>
            <span class="n">xstr</span><span class="p">,</span>
            <span class="n">ystr</span><span class="p">,</span>
            <span class="n">zstr</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store model results, goodness-of-fit tests, and other information.</span>

<span class="sd">        :param modeltype: Type of IopC Model (ziopc or miopc).</span>
<span class="sd">        :param llik: Log-Likelihood.</span>
<span class="sd">        :param coef: Model coefficients.</span>
<span class="sd">        :param AIC: Model Akaike information criterion.</span>
<span class="sd">        :param vcov: Variance-Covariance matrix.</span>
<span class="sd">            (optimized as inverted Hessian matrix)</span>
<span class="sd">        :param data: Full dataset.</span>
<span class="sd">        :param ts: Cutpoints for ordered probit.</span>
<span class="sd">        :param zs: Inflation stage estimates (Gammas).</span>
<span class="sd">        :param xs: Ordered probit estimates (Betas).</span>
<span class="sd">        :param rho: Rho.</span>
<span class="sd">        :param yncat: Number of categories in Dependent Variable (DV).</span>
<span class="sd">        :param x_: X Data.</span>
<span class="sd">        :param yx_: Y (DV) data.</span>
<span class="sd">        :param z_: Z Data.</span>
<span class="sd">        :param xstr: list of strings for x names.</span>
<span class="sd">        :param ystr: list of strings for y names.</span>
<span class="sd">        :param zstr: list of strings for z names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">=</span> <span class="n">modeltype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llik</span> <span class="o">=</span> <span class="n">llik</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">coef</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="n">aic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">=</span> <span class="n">vcov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutpoints</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflate</span> <span class="o">=</span> <span class="n">zs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ycat</span> <span class="o">=</span> <span class="n">yncat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">yx_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">z_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ystr</span> <span class="o">=</span> <span class="n">ystr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zstr</span> <span class="o">=</span> <span class="n">zstr</span></div>


<div class="viewcode-block" id="FittedVals"><a class="viewcode-back" href="../api.html#zmiopc.FittedVals">[docs]</a><span class="k">class</span> <span class="nc">FittedVals</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store fitted values for iOP models.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responsefull</span><span class="p">,</span> <span class="n">responseordered</span><span class="p">,</span> <span class="n">responseinflation</span><span class="p">,</span>
                 <span class="n">linear</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store different type of equation in each attribute.</span>

<span class="sd">        :param responsefull: responsefull</span>
<span class="sd">        :param responseordered: responseordered</span>
<span class="sd">        :param responseinflation: responseinflation</span>
<span class="sd">        :param linear: linear</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responsefull</span> <span class="o">=</span> <span class="n">responsefull</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responseordered</span> <span class="o">=</span> <span class="n">responseordered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responseinflation</span> <span class="o">=</span> <span class="n">responseinflation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">linear</span></div>


<div class="viewcode-block" id="op"><a class="viewcode-back" href="../api.html#zmiopc.op">[docs]</a><span class="k">def</span> <span class="nf">op</span><span class="p">(</span><span class="n">pstart</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate likelihood function for Ordered Probit Model.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :type pstart: numpy.ndarray or list.</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :type x: pandas.core.frame.DataFrame</span>
<span class="sd">    :param y: DV.</span>
<span class="sd">    :type y: pandas.core.frame.DataFrame</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type data: pandas.core.frame.DataFrame</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :type weights: int</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :type offsetx: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">yncat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)]</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetx</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">lik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">likk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lik</span><span class="p">[</span><span class="n">lik</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">llik</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">likk</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llik</span></div>


<div class="viewcode-block" id="ziop"><a class="viewcode-back" href="../api.html#zmiopc.ziop">[docs]</a><span class="k">def</span> <span class="nf">ziop</span><span class="p">(</span><span class="n">pstart</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate likelihood function for Zero-inflated Model.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :type pstart: numpy.ndarray or list</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :type x: pandas.core.frame.DataFrame</span>
<span class="sd">    :param y: Dependent Variable (DV).</span>
<span class="sd">    :type y: pandas.core.frame.DataFrame</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: pandas.core.frame.DataFrame</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type data: pandas.core.frame.DataFrame</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :type weights: int</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :type offsetx: int</span>
<span class="sd">    :param offsetz: offset for z.</span>
<span class="sd">    :type offsetz: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">yncat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetz</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetx</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="n">lik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">likk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lik</span><span class="p">[</span><span class="n">lik</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">llik</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">likk</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llik</span></div>


<div class="viewcode-block" id="ziopc"><a class="viewcode-back" href="../api.html#zmiopc.ziopc">[docs]</a><span class="k">def</span> <span class="nf">ziopc</span><span class="p">(</span><span class="n">pstart</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate likelihood function for Zero-inflated Correlated-Errors Model.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :type pstart: numpy.ndarray or list</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :type x: pandas.core.frame.DataFrame</span>
<span class="sd">    :param y: Dependent Variable (DV)</span>
<span class="sd">    :type y: pandas.core.frame.DataFrame</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: pandas.core.frame.DataFrame</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type data: pandas.core.frame.DataFrame</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :type weights: int</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :type offsetx: int</span>
<span class="sd">    :param offsetz: offset for z.</span>
<span class="sd">    :type offsetz: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">yncat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">x_beta</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
    <span class="c1"># correlation</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">cutb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetz</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetx</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">inf</span><span class="p">])</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">nsigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="n">cut</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span>
        <span class="n">cutb</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xb</span> <span class="o">-</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">upperb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">upperb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">cutb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="n">upper</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">cut</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="n">probs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upperb</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">means</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">probs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="o">+</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                                        <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                      <span class="n">cut</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                        <span class="n">cut</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">likk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lik</span><span class="p">[</span><span class="n">lik</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">llik</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">likk</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llik</span></div>


<div class="viewcode-block" id="miop"><a class="viewcode-back" href="../api.html#zmiopc.miop">[docs]</a><span class="k">def</span> <span class="nf">miop</span><span class="p">(</span><span class="n">pstart</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Likelihood function for Middle-inflated Ordered Probit Model</span>
<span class="sd">    &quot;without&quot; correlated errors.</span>
<span class="sd">    Number of outcomes must be odd.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :type pstart: numpy.ndarray or list</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :type x: pandas.core.frame.DataFrame</span>
<span class="sd">    :param y: Dependent Variable (DV)</span>
<span class="sd">    :type y: pandas.core.frame.DataFrame</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: pandas.core.frame.DataFrame</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type data: pandas.core.frame.DataFrame</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :type weights: int</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :type offsetx: int</span>
<span class="sd">    :param offsetz: offset for z.</span>
<span class="sd">    :type offsetz: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">yncat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pstart</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetz</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetx</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">)):</span>
            <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span>
                    <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="n">lik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">likk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lik</span><span class="p">[</span><span class="n">lik</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">llik</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">likk</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llik</span></div>


<div class="viewcode-block" id="miopc"><a class="viewcode-back" href="../api.html#zmiopc.miopc">[docs]</a><span class="k">def</span> <span class="nf">miopc</span><span class="p">(</span><span class="n">pstart</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Likelihood function for Middle-inflated Correlated-Errors Model.</span>
<span class="sd">    Number of outcomes must be odd.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :type pstart: numpy.ndarray or list</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :type x: pandas.core.frame.DataFrame</span>
<span class="sd">    :param y: Dependent Variable (DV).</span>
<span class="sd">    :type y: pandas.core.frame.DataFrame</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: pandas.core.frame.DataFrame</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type data: pandas.core.frame.DataFrame</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :type weights: int</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :type offsetx: int</span>
<span class="sd">    :param offsetz: offset for z.</span>
<span class="sd">    :type offsetz: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">yncat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pstart</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">x_beta</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">pstart</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pstart</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">cutpoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">cutpointb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetz</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">offsetx</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">inf</span><span class="p">])</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">nsigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="n">cutpoint</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span>
        <span class="n">cutpointb</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xb</span> <span class="o">-</span> <span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">upperb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_beta</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">upperb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">cutpointb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="n">upper</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">cutpoint</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="n">probs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upperb</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">means</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">probs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">)):</span>
                <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="o">+</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cutpoint</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span>
                                    <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cutpoint</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span>
                                    <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cutpoint</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span>
                                  <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cutpoint</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">means</span><span class="p">,</span>
                                    <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
    <span class="n">lik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">likk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lik</span><span class="p">[</span><span class="n">lik</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">llik</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">likk</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llik</span></div>


<div class="viewcode-block" id="opresults"><a class="viewcode-back" href="../api.html#zmiopc.opresults">[docs]</a><span class="k">def</span> <span class="nf">opresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Produce estimation results, part of :py:func:`opmod`.</span>

<span class="sd">    :param model: model object created from minimization.</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :param x: Independent variables.</span>
<span class="sd">    :param y: : Dependent Variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">ses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">))</span>
    <span class="n">tscore</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">ses</span>
    <span class="n">pval</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tscore</span><span class="p">))))</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">lci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">uci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Coef&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="s2">&quot;SE&quot;</span><span class="p">:</span> <span class="n">ses</span><span class="p">,</span>
            <span class="s2">&quot;tscore&quot;</span><span class="p">:</span> <span class="n">tscore</span><span class="p">,</span>
            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">pval</span><span class="p">,</span>
            <span class="s2">&quot;2.5%&quot;</span><span class="p">:</span> <span class="n">lci</span><span class="p">,</span>
            <span class="s2">&quot;97.5%&quot;</span><span class="p">:</span> <span class="n">uci</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">names</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">OpModel</span><span class="p">(</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span>
        <span class="n">yncat</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="opmod"><a class="viewcode-back" href="../api.html#zmiopc.opmod">[docs]</a><span class="k">def</span> <span class="nf">opmod</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pstart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offsetx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Estimate Ordered Probit model and return :class:`OpModel` class object.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :param data: full dataset.</span>
<span class="sd">    :type x: list of str</span>
<span class="sd">    :param y: Dependent Variable (DV).</span>
<span class="sd">    :type y: list of str</span>
<span class="sd">    :param method: method for optimization, default &#39;BFGS&#39;.</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :return: OpModel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">pstart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="p">((</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">op</span><span class="p">,</span>
        <span class="n">pstart</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">),</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">opresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="iopresults"><a class="viewcode-back" href="../api.html#zmiopc.iopresults">[docs]</a><span class="k">def</span> <span class="nf">iopresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">modeltype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Produce estimation results, part of :py:func:`iopmod`.</span>

<span class="sd">    :param model: model object created from minimization.</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :param y: : Dependent Variable (DV).</span>
<span class="sd">    :param z: : Inflation stage variables.</span>
<span class="sd">    :param modeltype: : &#39;ziop&#39; or &#39;miop&#39; model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
    <span class="n">z_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
    <span class="n">z_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="p">)))</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Inflation: &quot;</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ordered: &quot;</span> <span class="o">+</span> <span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span>
         <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">ses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">))</span>
    <span class="n">tscore</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">ses</span>
    <span class="n">pval</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tscore</span><span class="p">))))</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">lci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">uci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Coef&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="s2">&quot;SE&quot;</span><span class="p">:</span> <span class="n">ses</span><span class="p">,</span>
            <span class="s2">&quot;tscore&quot;</span><span class="p">:</span> <span class="n">tscore</span><span class="p">,</span>
            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">pval</span><span class="p">,</span>
            <span class="s2">&quot;2.5%&quot;</span><span class="p">:</span> <span class="n">lci</span><span class="p">,</span>
            <span class="s2">&quot;97.5%&quot;</span><span class="p">:</span> <span class="n">uci</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">names</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">IopModel</span><span class="p">(</span>
        <span class="n">modeltype</span><span class="p">,</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
        <span class="n">coef</span><span class="p">,</span>
        <span class="n">aic</span><span class="p">,</span>
        <span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">,</span>
        <span class="n">datasetnew</span><span class="p">,</span>
        <span class="n">xs</span><span class="p">,</span>
        <span class="n">zs</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">,</span>
        <span class="n">x_</span><span class="p">,</span>
        <span class="n">yx_</span><span class="p">,</span>
        <span class="n">z_</span><span class="p">,</span>
        <span class="n">yncat</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">z</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="iopcresults"><a class="viewcode-back" href="../api.html#zmiopc.iopcresults">[docs]</a><span class="k">def</span> <span class="nf">iopcresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">modeltype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Produce estimation results, part of :py:func:`ziopc  mod`.</span>

<span class="sd">    :param model: model object created from minimization.</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :param x: Ordered stage variables.</span>
<span class="sd">    :param y: : Dependent Variable (DV).</span>
<span class="sd">    :param z: : Inflation stage variables.</span>
<span class="sd">    :param modeltype: : Type of model. Options are: &#39;ziopc&#39; or &#39;miopc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
    <span class="n">z_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
    <span class="n">z_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="p">)))</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Inflation: &quot;</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ordered: &quot;</span> <span class="o">+</span> <span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span>
         <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">yncat</span> <span class="o">+</span> <span class="n">z_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">))</span>
    <span class="n">tscore</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">ses</span>
    <span class="n">pval</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tscore</span><span class="p">))))</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">lci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">uci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">ses</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Coef&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="s2">&quot;SE&quot;</span><span class="p">:</span> <span class="n">ses</span><span class="p">,</span>
            <span class="s2">&quot;tscore&quot;</span><span class="p">:</span> <span class="n">tscore</span><span class="p">,</span>
            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">pval</span><span class="p">,</span>
            <span class="s2">&quot;2.5%&quot;</span><span class="p">:</span> <span class="n">lci</span><span class="p">,</span>
            <span class="s2">&quot;97.5%&quot;</span><span class="p">:</span> <span class="n">uci</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">names</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">IopCModel</span><span class="p">(</span>
        <span class="n">modeltype</span><span class="p">,</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
        <span class="n">coef</span><span class="p">,</span>
        <span class="n">aic</span><span class="p">,</span>
        <span class="n">model</span><span class="o">.</span><span class="n">hess_inv</span><span class="p">,</span>
        <span class="n">datasetnew</span><span class="p">,</span>
        <span class="n">xs</span><span class="p">,</span>
        <span class="n">zs</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">,</span>
        <span class="n">x_</span><span class="p">,</span>
        <span class="n">yx_</span><span class="p">,</span>
        <span class="n">z_</span><span class="p">,</span>
        <span class="n">rho</span><span class="p">,</span>
        <span class="n">yncat</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">z</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="iopmod"><a class="viewcode-back" href="../api.html#zmiopc.iopmod">[docs]</a><span class="k">def</span> <span class="nf">iopmod</span><span class="p">(</span>
        <span class="n">modeltype</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">z</span><span class="p">,</span>
        <span class="n">pstart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">offsetx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">offsetz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Estimate ZiOP model and return :class:`IopModel` class object as output.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :param data: full dataset.</span>
<span class="sd">    :type x: list of str.</span>
<span class="sd">    :param y: Dependent Variable (DV).</span>
<span class="sd">    :type y: list of str.</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: list of str.</span>
<span class="sd">    :param modeltype: must be one of &quot;ziop&quot; or &#39;miop&#39;.</span>
<span class="sd">    :param method: method for optimization, default &#39;BFGS&#39;.</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :param offsetz: offset for Z.</span>
<span class="sd">    :return: IopModel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ziop&quot;</span><span class="p">,</span> <span class="s2">&quot;miop&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">modeltype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
        <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
        <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
        <span class="n">z_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
        <span class="n">z_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ones&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">pstart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;ziop&quot;</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">ziop</span><span class="p">,</span>
                <span class="n">pstart</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">z_</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">),</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;miop&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="n">miop</span><span class="p">,</span>
                    <span class="n">pstart</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">z_</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;miop requires odd number of categories.&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">iopresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">modeltype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;type must be ziop or miop&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="iopcmod"><a class="viewcode-back" href="../api.html#zmiopc.iopcmod">[docs]</a><span class="k">def</span> <span class="nf">iopcmod</span><span class="p">(</span>
        <span class="n">modeltype</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">z</span><span class="p">,</span>
        <span class="n">pstart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">offsetx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">offsetz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Estimate an iOP model (ZiOP or MiOP) and return :class:`IopcModel`.</span>

<span class="sd">    :param pstart: starting parameters.</span>
<span class="sd">    :param data: dataset.</span>
<span class="sd">    :type x: list of str</span>
<span class="sd">    :param y: Dependent Variable (DV).</span>
<span class="sd">    :type y: list of str</span>
<span class="sd">    :param z: Inflation stage variables.</span>
<span class="sd">    :type z: list of str</span>
<span class="sd">    :param modeltype: Type of model to be estimated (&quot;ziopc&quot; or &#39;miopc&#39;).</span>
<span class="sd">    :param method: method for optimization, default &#39;BFGS&#39;</span>
<span class="sd">    :param weights: weights.</span>
<span class="sd">    :param offsetx: offset for X.</span>
<span class="sd">    :param offsetz: offset for Z.</span>
<span class="sd">    :return: IopCModel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ziopc&quot;</span><span class="p">,</span> <span class="s2">&quot;miopc&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">modeltype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
        <span class="n">varlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">varlist</span><span class="p">]</span>
        <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
        <span class="n">datasetnew</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">yx_</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yx_</span><span class="p">))</span>
        <span class="n">z_</span> <span class="o">=</span> <span class="n">datasetnew</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
        <span class="n">z_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ones&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">pstart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
                <span class="mf">0.01</span><span class="p">,</span> <span class="p">((</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;ziopc&quot;</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">ziopc</span><span class="p">,</span>
                <span class="n">pstart</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">z_</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">),</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;miopc&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="n">miopc</span><span class="p">,</span>
                    <span class="n">pstart</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">yx_</span><span class="p">,</span> <span class="n">z_</span><span class="p">,</span> <span class="n">datasetnew</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">,</span> <span class="n">offsetz</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;miopc requires odd number of categories.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">iopcresults</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">modeltype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;type must be ziopc or miopc&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="iopfit"><a class="viewcode-back" href="../api.html#zmiopc.iopfit">[docs]</a><span class="k">def</span> <span class="nf">iopfit</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate probabilities from :py:func:`iopmod`.</span>

<span class="sd">    :param model: :class:IopModel object from :py:func:`iopmod`</span>
<span class="sd">    :return: :class:FittedVals object with fitted values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">)</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;ziop&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">probs</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">))</span>
                                            <span class="o">-</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                                                        <span class="o">-</span> <span class="n">xb</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;miop&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">)):</span>
                <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span>
                        <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
                        <span class="o">*</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
                           <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
                        <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">))</span>
    <span class="n">probsordered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">probsordered</span><span class="p">[:,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
        <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="n">probsordered</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probsordered</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">probsinfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">probsinfl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="n">probslin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ZG&quot;</span><span class="p">:</span> <span class="n">zg</span><span class="p">,</span> <span class="s2">&quot;XB&quot;</span><span class="p">:</span> <span class="n">xb</span><span class="p">})</span>
    <span class="n">fitted</span> <span class="o">=</span> <span class="n">FittedVals</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">probsordered</span><span class="p">,</span> <span class="n">probsinfl</span><span class="p">,</span> <span class="n">probslin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fitted</span></div>


<div class="viewcode-block" id="iopcfit"><a class="viewcode-back" href="../api.html#zmiopc.iopcfit">[docs]</a><span class="k">def</span> <span class="nf">iopcfit</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate fitted probabilities from :py:func:`iopcmod`.</span>

<span class="sd">    :param model: :class:`IopCModel` object from :py:func:`iopcmod`</span>
<span class="sd">    :return: :class:`FittedVals` object with fitted values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">)</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">inf</span><span class="p">])</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">nsigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">rho</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">rho</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;ziopc&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                <span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])],</span> <span class="n">means</span><span class="p">,</span>
                <span class="n">sigma</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                <span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span> <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                  <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span>
                                            <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                            <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                              <span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                                  <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                                      <span class="n">lower</span><span class="p">,</span>
                                      <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                      <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span>
                                  <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                              <span class="p">)</span>
    <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">modeltype</span> <span class="o">==</span> <span class="s2">&quot;miopc&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                <span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])],</span> <span class="n">means</span><span class="p">,</span>
                <span class="n">sigma</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                <span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span> <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">)):</span>
                    <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span>
                                <span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="o">-</span> <span class="p">(</span><span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span>
                                         <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                                  <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                         <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span>
                                             <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                             <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span>
                                      <span class="n">mvn</span><span class="o">.</span><span class="n">mvnun</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="p">[</span><span class="n">zg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                                         <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                                                <span class="n">means</span><span class="p">,</span> <span class="n">nsigma</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># ordered</span>
    <span class="n">probsordered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">probsordered</span><span class="p">[:,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
        <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="n">probsordered</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probsordered</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">probsinfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">probsinfl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg</span><span class="p">)</span>
    <span class="n">probslin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;zg&quot;</span><span class="p">:</span> <span class="n">zg</span><span class="p">,</span> <span class="s2">&quot;xb&quot;</span><span class="p">:</span> <span class="n">xb</span><span class="p">})</span>
    <span class="n">fitted</span> <span class="o">=</span> <span class="n">FittedVals</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">probsordered</span><span class="p">,</span> <span class="n">probsinfl</span><span class="p">,</span> <span class="n">probslin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fitted</span></div>


<div class="viewcode-block" id="vuong_opiop"><a class="viewcode-back" href="../api.html#zmiopc.vuong_opiop">[docs]</a><span class="k">def</span> <span class="nf">vuong_opiop</span><span class="p">(</span><span class="n">opmodel</span><span class="p">,</span> <span class="n">iopmodel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the Vuong test to compare the performance of the OP and iOP model.</span>

<span class="sd">    :param opmodel: The OP model from :class:`OpModel`.</span>
<span class="sd">    :param iopmodel: The ZiOP model from :class:`IopModel`.</span>
<span class="sd">    :return: vuongopiop: Result of the Vuong test</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">iopmodel</span><span class="o">.</span><span class="n">Y</span>
    <span class="c1"># can also y = opmodel.Y when 2 models have the same length</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">iopmodel</span><span class="o">.</span><span class="n">X</span>
    <span class="c1"># can also x = opmodel.X when 2 models have the same length</span>
    <span class="n">cuts_op</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">xop</span> <span class="o">=</span> <span class="n">opmodel</span><span class="o">.</span><span class="n">ordered</span>
    <span class="n">cuts_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">)):</span>
        <span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">xbop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">xbop</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">xbop_sum</span> <span class="o">=</span> <span class="n">xbop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fitttediop</span> <span class="o">=</span> <span class="n">iopfit</span><span class="p">(</span><span class="n">iopmodel</span><span class="p">)</span><span class="o">.</span><span class="n">responsefull</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cuts_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">)</span> <span class="o">/</span> <span class="n">fitttediop</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
        <span class="n">cuts_op</span><span class="p">[</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">))</span> <span class="o">/</span> <span class="n">fitttediop</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">)</span>
                       <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                  <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">))</span> <span class="o">/</span> <span class="n">fitttediop</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">mlog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">diffmsq</span> <span class="o">=</span> <span class="p">(</span><span class="n">mlog</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mlog</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">sumdms</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diffmsq</span><span class="p">)</span>
    <span class="n">vuongopiop</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mlog</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sumdms</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vuongopiop</span></div>


<div class="viewcode-block" id="vuong_opiopc"><a class="viewcode-back" href="../api.html#zmiopc.vuong_opiopc">[docs]</a><span class="k">def</span> <span class="nf">vuong_opiopc</span><span class="p">(</span><span class="n">opmodel</span><span class="p">,</span> <span class="n">iopcmodel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the Vuong test to compare the performance of the OP and iOPC model.</span>

<span class="sd">    :param opmodel: The OP model from :class:`OpModel`.</span>
<span class="sd">    :param iopcmodel: The iOPC model from :class:`IopCModel`.</span>
<span class="sd">    :return: vuongopiopc: Result of the Vuong test</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">iopcmodel</span><span class="o">.</span><span class="n">Y</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">iopcmodel</span><span class="o">.</span><span class="n">X</span>
    <span class="n">cuts_op</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">xop</span> <span class="o">=</span> <span class="n">opmodel</span><span class="o">.</span><span class="n">ordered</span>
    <span class="n">cuts_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">)):</span>
        <span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">opmodel</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">xbop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">xbop</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">xbop_sum</span> <span class="o">=</span> <span class="n">xbop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fitttedziopc</span> <span class="o">=</span> <span class="n">iopcfit</span><span class="p">(</span><span class="n">iopcmodel</span><span class="p">)</span><span class="o">.</span><span class="n">responsefull</span>
    <span class="n">ycat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="n">ycatu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">yncat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ycatu</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cuts_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">)</span> <span class="o">/</span> <span class="n">fitttedziopc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">probs</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
        <span class="n">cuts_op</span><span class="p">[</span><span class="n">yncat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">))</span> <span class="o">/</span> <span class="n">fitttedziopc</span><span class="p">[:,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yncat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">)</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
            <span class="n">cuts_op</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbop_sum</span><span class="p">))</span> <span class="o">/</span> <span class="n">fitttedziopc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">yncat</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yncat</span><span class="p">):</span>
            <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">probs</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">mlog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">diffmsq</span> <span class="o">=</span> <span class="p">(</span><span class="n">mlog</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mlog</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">sumdms</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diffmsq</span><span class="p">)</span>
    <span class="n">vuongopiopc</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mlog</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sumdms</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vuongopiopc</span></div>


<div class="viewcode-block" id="split_effects"><a class="viewcode-back" href="../api.html#zmiopc.split_effects">[docs]</a><span class="k">def</span> <span class="nf">split_effects</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inflvar</span><span class="p">,</span> <span class="n">nsims</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate change in probability of being 0 in the split-probit stage.</span>

<span class="sd">    This function calculates the predicted probabilities</span>
<span class="sd">    when there is change in value of a variable in the split-probit equation.</span>
<span class="sd">    The chosen dummy variable is changed from 0 to 1,</span>
<span class="sd">    and chosen numerical variable is mean value + 1 standard deviation.</span>
<span class="sd">    Other variables are kept at 0 or mean value</span>
<span class="sd">    (Note: the current version of the function</span>
<span class="sd">    recognize ordinal variables as numerical).</span>

<span class="sd">    :param model: :class:`IopModel` or :class:`IopCModel`.</span>
<span class="sd">    :param inflvar: int representing the location of variable</span>
<span class="sd">        in the split-probit equation.</span>
<span class="sd">        (attribute .inflate of :class:`IopModel` or :class:`IopCModel`)</span>
<span class="sd">    :param nsims: number of simulated observations, default to 10000.</span>
<span class="sd">    :return: changeprobs: a dataframe of the predicted</span>
<span class="sd">        probabilities when there is change in the variable (1)</span>
<span class="sd">        versus original values (0).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">vcov</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">vcov</span>
    <span class="n">model_z</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Z</span>
    <span class="n">zsim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">zsim1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">zsima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">zsima</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>
            <span class="n">zsim1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zsim1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>
            <span class="n">zsima</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zsima</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">model_z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">zsim2</span> <span class="o">=</span> <span class="n">zsim1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">zsim2</span><span class="p">[</span><span class="n">inflvar</span><span class="p">]</span> <span class="o">=</span> <span class="n">zsima</span><span class="p">[</span><span class="n">inflvar</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">probs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsims</span><span class="p">)</span>
    <span class="n">probs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsims</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsims</span><span class="p">):</span>
        <span class="n">gsim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">estimate</span><span class="p">,</span> <span class="n">vcov</span><span class="p">)</span>
        <span class="n">gsim2</span> <span class="o">=</span> <span class="n">gsim</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">)]</span>
        <span class="n">zg1</span> <span class="o">=</span> <span class="n">zsim1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gsim2</span><span class="p">)</span>
        <span class="n">zg2</span> <span class="o">=</span> <span class="n">zsim2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gsim2</span><span class="p">)</span>
        <span class="n">probs1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg1</span><span class="p">)</span>
        <span class="n">probs2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">zg2</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">inflvar</span><span class="p">]</span>
    <span class="n">changeprobs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Inflation: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;= 0&quot;</span><span class="p">:</span> <span class="n">probs1</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Inflation: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;= 1&quot;</span><span class="p">:</span> <span class="n">probs2</span><span class="p">}</span>
                               <span class="p">)</span>
    <span class="k">return</span> <span class="n">changeprobs</span></div>


<div class="viewcode-block" id="ordered_effects"><a class="viewcode-back" href="../api.html#zmiopc.ordered_effects">[docs]</a><span class="k">def</span> <span class="nf">ordered_effects</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ordvar</span><span class="p">,</span> <span class="n">nsims</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the changes in probability in each outcome in OP stage.</span>

<span class="sd">    This function calculates predicted probabilities</span>
<span class="sd">    when there is change in value of a variable</span>
<span class="sd">    in the ordered probit equation.</span>
<span class="sd">    The chosen dummy variable is changed from 0 to 1,</span>
<span class="sd">    and chosen numerical variable is mean value + 1 standard deviation.</span>
<span class="sd">    Other variables are kept at 0 or mean value</span>
<span class="sd">    (Note: the current version of the function</span>
<span class="sd">    recognize ordinal variables as numerical).</span>

<span class="sd">    :param model: :class:`IopModel` or :class:`IopCModel`.</span>
<span class="sd">    :param ordvar: int representing the location of variable</span>
<span class="sd">        in the ordered probit equation.</span>
<span class="sd">        (attribute .ordered of :class:`IopModel` or :class:`IopCModel`)</span>
<span class="sd">    :param nsims: number of simulated observations, default to 10000.</span>
<span class="sd">    :return: changeprobs: a dataframe of the predicted</span>
<span class="sd">        probabilities when there is change in the variable for each outcome (1)</span>
<span class="sd">        versus original values (0).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">vcov</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">vcov</span>
    <span class="n">model_x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span>
    <span class="n">xsim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">xsima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>
            <span class="n">xsim1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xsim1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>
            <span class="n">xsima</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xsima</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">model_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">xsim2</span> <span class="o">=</span> <span class="n">xsim1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">xsim2</span><span class="p">[</span><span class="n">ordvar</span><span class="p">]</span> <span class="o">=</span> <span class="n">xsima</span><span class="p">[</span><span class="n">ordvar</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">probsordered1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">probsordered2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">)</span>
    <span class="n">cprobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cutpoints</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">probs1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsims</span><span class="p">),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">probs2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsims</span><span class="p">),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">)</span> <span class="o">+</span> <span class="n">ordvar</span><span class="p">]</span>
    <span class="n">probs1</span> <span class="o">=</span> <span class="n">probs1</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Ordered: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = 0&quot;</span><span class="p">)</span>
    <span class="n">probs2</span> <span class="o">=</span> <span class="n">probs2</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Ordered: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = 1&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsims</span><span class="p">):</span>
        <span class="n">bsim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">estimate</span><span class="p">,</span> <span class="n">vcov</span><span class="p">)</span>
        <span class="n">bsim2</span> <span class="o">=</span> <span class="n">bsim</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">):</span>
                     <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inflate</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ordered</span><span class="p">)]</span>
        <span class="n">xb1</span> <span class="o">=</span> <span class="n">xsim1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bsim2</span><span class="p">)</span>
        <span class="n">xb2</span> <span class="o">=</span> <span class="n">xsim2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bsim2</span><span class="p">)</span>
        <span class="n">probsordered1</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb1</span><span class="p">)</span>
        <span class="n">probsordered1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">probsordered1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">probsordered2</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
            <span class="n">cprobs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb2</span><span class="p">)</span>
        <span class="n">probsordered2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">probsordered2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">cprobs</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xb2</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">probs1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:,</span> <span class="p">]</span> <span class="o">=</span> <span class="n">probsordered1</span>
        <span class="n">probs2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:,</span> <span class="p">]</span> <span class="o">=</span> <span class="n">probsordered2</span>
    <span class="n">changeprobs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsims</span><span class="p">),</span>
                               <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">))</span>
    <span class="n">newnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">changeprobs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="nb">round</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">changeprobs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="nb">round</span><span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">newnames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probs1</span><span class="o">.</span><span class="n">columns</span><span class="p">)[</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycat</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">newnames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">probs2</span><span class="o">.</span><span class="n">columns</span><span class="p">)[</span><span class="nb">round</span><span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">changeprobs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">newnames</span>
    <span class="k">return</span> <span class="n">changeprobs</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">IDCeMPy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Nguyen Huynh.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.0.
    </div>
  </body>
</html>